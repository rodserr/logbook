{
  "hash": "ff969fc0ea51f0f63c9ab5d295213387",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Liverpool 20-21 EPL Performance\"\ndescription: |\n  Analysis of EPL 20/21 season of Liverpool FC using tidyverse\nauthor:\n  - name: Rodrigo Serrano\n    url: https://rodserr.github.io/logbook\ndate: 2021-05-31\nimage: liverpool-logo.png\n---\n\n\n\n\nOn the last match of the 20/21 season, Liverpool celebrated their Champions League qualification, almost as if they had won a title. In mid-January the team fell into a negative streak, to the point of breaking the record for the most consecutive games losing at Anfield. In this post we will try to quantify this turbulent season using [tidyverse](https://www.tidyverse.org/). All data is extracted from [understat](https://understat.com/) through [understatr](https://ewenme.github.io/understatr/index.html) package\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(understatr)\nlibrary(ggsoccer)\nlibrary(gt)\nlibrary(patchwork)\nlibrary(here)\n```\n:::\n\n\n\n\n## Season Data\n\n`get_league_teams_stats` function retrieve results at the season-team level. Let's ask for the last three seasons and compare LFC rolling points. Note that understat labels the season with the first year of it, for example when we say 2020 season it would be 2020/2021\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nepl <- list(2020, 2019, 2018) %>%\n  map_df(~get_league_teams_stats('EPL', year = .x))\n```\n:::\n\n\nLet's compare LFC runs in the last three seasons \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Filter only LFC games\nmatch_season <- epl %>% filter(team_name == 'Liverpool')\n\n# Group by year and cumsum pts\nmatch_season %>% \n  arrange(date) %>%\n  group_by(year) %>% \n  transmute(\n    cm_pts = cumsum(pts),\n    Matches = 1:n(),\n    .label = if_else(cm_pts == last(cm_pts), as.character(year), NA_character_)\n  ) %>% \n  ggplot(\n    aes(x = Matches, y = cm_pts, color = as_factor(year), alpha = (year != 2020))\n  ) +\n  geom_line() +\n  ggrepel::geom_label_repel(aes(label = .label), nudge_x = 1, na.rm = TRUE) +\n  scale_alpha_manual(values = c(1, .3), guide = FALSE) +\n  theme(legend.position = 'none') +\n  labs(y = 'Points', title = 'Cumulative Points')\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/season_comparison-1.png){fig-align='center' width=576}\n:::\n:::\n\n\nThe gap increases after the 14th match, but it begins to recover around the 30th. 2018 and 2019 were amazing seasons, it would be hard to have that slope again\n\nunderstat provides expected goals **xG**, a very popular metric in soccer analytics. According to their page\n\n> ...more and more sports analytics turn to the advanced models like xG, which is a statistical measure of the quality of chances created and conceded... we trained neural network prediction algorithms with the large dataset (>100,000 shots, over 10 parameters for each)\n\nLet's see how many matches LFC couldn't win having greater xG than his rival\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nmatch_season %>% \n  filter((xG > xGA) & result != 'w') %>% \n  group_by(year) %>% \n  summarise(\n    `Nº Matches` = n(),\n    `Points` = 3*n()-sum(pts)\n  ) %>% \n  gt() %>% \n  tab_header(title = 'Missed Wins')\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"uwzealykkp\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#uwzealykkp table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#uwzealykkp thead, #uwzealykkp tbody, #uwzealykkp tfoot, #uwzealykkp tr, #uwzealykkp td, #uwzealykkp th {\n  border-style: none;\n}\n\n#uwzealykkp p {\n  margin: 0;\n  padding: 0;\n}\n\n#uwzealykkp .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#uwzealykkp .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#uwzealykkp .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#uwzealykkp .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#uwzealykkp .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#uwzealykkp .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#uwzealykkp .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#uwzealykkp .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#uwzealykkp .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#uwzealykkp .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#uwzealykkp .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#uwzealykkp .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#uwzealykkp .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#uwzealykkp .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#uwzealykkp .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#uwzealykkp .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#uwzealykkp .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#uwzealykkp .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#uwzealykkp .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#uwzealykkp .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#uwzealykkp .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#uwzealykkp .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#uwzealykkp .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#uwzealykkp .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#uwzealykkp .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#uwzealykkp .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#uwzealykkp .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#uwzealykkp .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#uwzealykkp .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#uwzealykkp .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#uwzealykkp .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#uwzealykkp .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#uwzealykkp .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#uwzealykkp .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#uwzealykkp .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#uwzealykkp .gt_left {\n  text-align: left;\n}\n\n#uwzealykkp .gt_center {\n  text-align: center;\n}\n\n#uwzealykkp .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#uwzealykkp .gt_font_normal {\n  font-weight: normal;\n}\n\n#uwzealykkp .gt_font_bold {\n  font-weight: bold;\n}\n\n#uwzealykkp .gt_font_italic {\n  font-style: italic;\n}\n\n#uwzealykkp .gt_super {\n  font-size: 65%;\n}\n\n#uwzealykkp .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#uwzealykkp .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#uwzealykkp .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#uwzealykkp .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#uwzealykkp .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#uwzealykkp .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#uwzealykkp .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_heading\">\n      <td colspan=\"3\" class=\"gt_heading gt_title gt_font_normal gt_bottom_border\" style>Missed Wins</td>\n    </tr>\n    \n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"year\">year</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Nº Matches\">Nº Matches</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Points\">Points</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"year\" class=\"gt_row gt_right\">2018</td>\n<td headers=\"Nº Matches\" class=\"gt_row gt_right\">3</td>\n<td headers=\"Points\" class=\"gt_row gt_right\">7</td></tr>\n    <tr><td headers=\"year\" class=\"gt_row gt_right\">2019</td>\n<td headers=\"Nº Matches\" class=\"gt_row gt_right\">4</td>\n<td headers=\"Points\" class=\"gt_row gt_right\">9</td></tr>\n    <tr><td headers=\"year\" class=\"gt_row gt_right\">2020</td>\n<td headers=\"Nº Matches\" class=\"gt_row gt_right\">8</td>\n<td headers=\"Points\" class=\"gt_row gt_right\">18</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\nThe number of matches doubles the previous two season, losing 18 points in games where LFC supposed to have an advantage\n\n## Match Data\n\nWe can ask for stats of every LFC player at season level\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Get players stats\nplayer_season <- list(2020, 2019, 2018) %>% \n  map_df(~get_team_players_stats('Liverpool', year = .x))\n```\n:::\n\n\n`understatr` also provides shots and stats for single matches, but we need to know each `match_id`, which appears only on player-match level data. Let's find all `match_id`s for LFC 2020 season by looking at games where *Fabinho*, *Jota* and *Thiago* played. Later in the post we will analyze these players individually\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Get games from players\nplayer_match <- list(6854, 229, 3420) %>% \n  map_df(~get_player_matches_stats(.x))\n\n# Distinct matches ids from 2020 season\nmatch_ids <- player_match %>%\n  filter(year == 2020) %>%\n  distinct(match_id) %>%\n  pull()\n\n# Get shots from every game\nmatch_shots <- map_df(match_ids, ~get_match_shots(.x))\n\n# Get stats from every game\nmatch_stats <- map_df(match_ids, ~get_match_stats(.x))\n```\n:::\n\n\n## Injured Defense\n\nLFC's main problems this season were due to the injuries of their 3 main Central defenses early on the season. Let's check DC performances with match stats data and join it with shots/goals conceded\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Shots conceded by LFC \nshots_against <- match_shots %>% \n  filter((h_team != 'Liverpool' & h_a == 'h') | (a_team != 'Liverpool' & h_a == 'a')) %>% \n  filter(result != 'OwnGoal') %>% \n  group_by(match_id) %>% \n  summarise(\n    shots = n(),\n    goals_against = sum(result == 'Goal')\n  )\n\n# DC pairs from every 2020 game\ncentral_def <- match_stats %>% \n  filter(team_id == 87, position == 'DC')\n\n# Paste players names & Join with shots conceded\ncentral_def_pairs <- central_def %>% \n  group_by(match_id) %>% \n  arrange(player) %>% # So player order do not affect \n  dplyr::summarise(pair = paste0(player, collapse = ' - ')) %>% \n  left_join(shots_against, by = 'match_id')\n\n# Distinct pairs\nn_pairs <- unique(central_def_pairs$pair) %>% length()\n\n# Individual DC with most appears\ndc_more_appears <- central_def %>% count(player) %>% slice_max(order_by = n)\n\n# Build gtable\ncentral_def_pairs %>% \n  group_by(pair) %>% \n  summarise(\n    appearances = n(), \n    shots = sum(shots), \n    goals = sum(goals_against),\n    shots_per_game = round(shots/appearances, 1),\n    goals_per_game = round(goals/appearances, 1)\n  ) %>% \n  filter(appearances > 1) %>% \n  arrange(desc(appearances)) %>%\n  gt(rowname_col = 'pair') %>% \n  tab_header(\n    title = 'Goals/Shots Conceded by Pair DC', \n    subtitle = glue::glue('Pairs with >1 appearence of {n_pairs} pairs used in the season')\n  ) %>% \n  tab_footnote(\n    locations = cells_column_labels(vars(appearances)),\n    footnote = glue::glue('{dc_more_appears$player} had the highest number of appearances with {dc_more_appears$n}')\n  ) %>% \n  cols_align('center')\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"sghwddvqkg\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#sghwddvqkg table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#sghwddvqkg thead, #sghwddvqkg tbody, #sghwddvqkg tfoot, #sghwddvqkg tr, #sghwddvqkg td, #sghwddvqkg th {\n  border-style: none;\n}\n\n#sghwddvqkg p {\n  margin: 0;\n  padding: 0;\n}\n\n#sghwddvqkg .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#sghwddvqkg .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#sghwddvqkg .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#sghwddvqkg .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#sghwddvqkg .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#sghwddvqkg .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#sghwddvqkg .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#sghwddvqkg .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#sghwddvqkg .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#sghwddvqkg .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#sghwddvqkg .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#sghwddvqkg .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#sghwddvqkg .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#sghwddvqkg .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#sghwddvqkg .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#sghwddvqkg .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#sghwddvqkg .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#sghwddvqkg .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#sghwddvqkg .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#sghwddvqkg .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#sghwddvqkg .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#sghwddvqkg .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#sghwddvqkg .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#sghwddvqkg .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#sghwddvqkg .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#sghwddvqkg .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#sghwddvqkg .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#sghwddvqkg .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#sghwddvqkg .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#sghwddvqkg .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#sghwddvqkg .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#sghwddvqkg .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#sghwddvqkg .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#sghwddvqkg .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#sghwddvqkg .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#sghwddvqkg .gt_left {\n  text-align: left;\n}\n\n#sghwddvqkg .gt_center {\n  text-align: center;\n}\n\n#sghwddvqkg .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#sghwddvqkg .gt_font_normal {\n  font-weight: normal;\n}\n\n#sghwddvqkg .gt_font_bold {\n  font-weight: bold;\n}\n\n#sghwddvqkg .gt_font_italic {\n  font-style: italic;\n}\n\n#sghwddvqkg .gt_super {\n  font-size: 65%;\n}\n\n#sghwddvqkg .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#sghwddvqkg .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#sghwddvqkg .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#sghwddvqkg .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#sghwddvqkg .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#sghwddvqkg .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#sghwddvqkg .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_heading\">\n      <td colspan=\"6\" class=\"gt_heading gt_title gt_font_normal\" style>Goals/Shots Conceded by Pair DC</td>\n    </tr>\n    <tr class=\"gt_heading\">\n      <td colspan=\"6\" class=\"gt_heading gt_subtitle gt_font_normal gt_bottom_border\" style>Pairs with &gt;1 appearence of 16 pairs used in the season</td>\n    </tr>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"\"></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"appearances&lt;span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;&gt;&lt;sup&gt;1&lt;/sup&gt;&lt;/span&gt;\">appearances<span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;\"><sup>1</sup></span></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"shots\">shots</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"goals\">goals</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"shots_per_game\">shots_per_game</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"goals_per_game\">goals_per_game</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><th id=\"stub_1_1\" scope=\"row\" class=\"gt_row gt_center gt_stub\">Fabinho - Joel Matip</th>\n<td headers=\"stub_1_1 appearances\" class=\"gt_row gt_center\">6</td>\n<td headers=\"stub_1_1 shots\" class=\"gt_row gt_center\">46</td>\n<td headers=\"stub_1_1 goals\" class=\"gt_row gt_center\">3</td>\n<td headers=\"stub_1_1 shots_per_game\" class=\"gt_row gt_center\">7.7</td>\n<td headers=\"stub_1_1 goals_per_game\" class=\"gt_row gt_center\">0.5</td></tr>\n    <tr><th id=\"stub_1_2\" scope=\"row\" class=\"gt_row gt_center gt_stub\">Nathaniel Phillips - Rhys Williams</th>\n<td headers=\"stub_1_2 appearances\" class=\"gt_row gt_center\">6</td>\n<td headers=\"stub_1_2 shots\" class=\"gt_row gt_center\">65</td>\n<td headers=\"stub_1_2 goals\" class=\"gt_row gt_center\">4</td>\n<td headers=\"stub_1_2 shots_per_game\" class=\"gt_row gt_center\">10.8</td>\n<td headers=\"stub_1_2 goals_per_game\" class=\"gt_row gt_center\">0.7</td></tr>\n    <tr><th id=\"stub_1_3\" scope=\"row\" class=\"gt_row gt_center gt_stub\">Nathaniel Phillips - Ozan Kabak</th>\n<td headers=\"stub_1_3 appearances\" class=\"gt_row gt_center\">4</td>\n<td headers=\"stub_1_3 shots\" class=\"gt_row gt_center\">30</td>\n<td headers=\"stub_1_3 goals\" class=\"gt_row gt_center\">1</td>\n<td headers=\"stub_1_3 shots_per_game\" class=\"gt_row gt_center\">7.5</td>\n<td headers=\"stub_1_3 goals_per_game\" class=\"gt_row gt_center\">0.2</td></tr>\n    <tr><th id=\"stub_1_4\" scope=\"row\" class=\"gt_row gt_center gt_stub\">Fabinho - Jordan Henderson</th>\n<td headers=\"stub_1_4 appearances\" class=\"gt_row gt_center\">3</td>\n<td headers=\"stub_1_4 shots\" class=\"gt_row gt_center\">23</td>\n<td headers=\"stub_1_4 goals\" class=\"gt_row gt_center\">5</td>\n<td headers=\"stub_1_4 shots_per_game\" class=\"gt_row gt_center\">7.7</td>\n<td headers=\"stub_1_4 goals_per_game\" class=\"gt_row gt_center\">1.7</td></tr>\n    <tr><th id=\"stub_1_5\" scope=\"row\" class=\"gt_row gt_center gt_stub\">Fabinho - Ozan Kabak</th>\n<td headers=\"stub_1_5 appearances\" class=\"gt_row gt_center\">3</td>\n<td headers=\"stub_1_5 shots\" class=\"gt_row gt_center\">30</td>\n<td headers=\"stub_1_5 goals\" class=\"gt_row gt_center\">3</td>\n<td headers=\"stub_1_5 shots_per_game\" class=\"gt_row gt_center\">10.0</td>\n<td headers=\"stub_1_5 goals_per_game\" class=\"gt_row gt_center\">1.0</td></tr>\n    <tr><th id=\"stub_1_6\" scope=\"row\" class=\"gt_row gt_center gt_stub\">Joseph Gomez - Virgil van Dijk</th>\n<td headers=\"stub_1_6 appearances\" class=\"gt_row gt_center\">3</td>\n<td headers=\"stub_1_6 shots\" class=\"gt_row gt_center\">28</td>\n<td headers=\"stub_1_6 goals\" class=\"gt_row gt_center\">11</td>\n<td headers=\"stub_1_6 shots_per_game\" class=\"gt_row gt_center\">9.3</td>\n<td headers=\"stub_1_6 goals_per_game\" class=\"gt_row gt_center\">3.7</td></tr>\n    <tr><th id=\"stub_1_7\" scope=\"row\" class=\"gt_row gt_center gt_stub\">Fabinho - Nathaniel Phillips</th>\n<td headers=\"stub_1_7 appearances\" class=\"gt_row gt_center\">2</td>\n<td headers=\"stub_1_7 shots\" class=\"gt_row gt_center\">19</td>\n<td headers=\"stub_1_7 goals\" class=\"gt_row gt_center\">1</td>\n<td headers=\"stub_1_7 shots_per_game\" class=\"gt_row gt_center\">9.5</td>\n<td headers=\"stub_1_7 goals_per_game\" class=\"gt_row gt_center\">0.5</td></tr>\n    <tr><th id=\"stub_1_8\" scope=\"row\" class=\"gt_row gt_center gt_stub\">Jordan Henderson - Nathaniel Phillips</th>\n<td headers=\"stub_1_8 appearances\" class=\"gt_row gt_center\">2</td>\n<td headers=\"stub_1_8 shots\" class=\"gt_row gt_center\">21</td>\n<td headers=\"stub_1_8 goals\" class=\"gt_row gt_center\">2</td>\n<td headers=\"stub_1_8 shots_per_game\" class=\"gt_row gt_center\">10.5</td>\n<td headers=\"stub_1_8 goals_per_game\" class=\"gt_row gt_center\">1.0</td></tr>\n    <tr><th id=\"stub_1_9\" scope=\"row\" class=\"gt_row gt_center gt_stub\">Jordan Henderson - Ozan Kabak</th>\n<td headers=\"stub_1_9 appearances\" class=\"gt_row gt_center\">2</td>\n<td headers=\"stub_1_9 shots\" class=\"gt_row gt_center\">20</td>\n<td headers=\"stub_1_9 goals\" class=\"gt_row gt_center\">5</td>\n<td headers=\"stub_1_9 shots_per_game\" class=\"gt_row gt_center\">10.0</td>\n<td headers=\"stub_1_9 goals_per_game\" class=\"gt_row gt_center\">2.5</td></tr>\n  </tbody>\n  \n  <tfoot class=\"gt_footnotes\">\n    <tr>\n      <td class=\"gt_footnote\" colspan=\"6\"><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;\"><sup>1</sup></span> Fabinho had the highest number of appearances with 17</td>\n    </tr>\n  </tfoot>\n</table>\n</div>\n```\n\n:::\n:::\n\n\nWow!! 16 different pairs of DC across the season. Starting pair Virgil-Gomez had only 3 appearances and have the most goals per game conceded due to the unfortunate loss against Aston Villa (7-2). Even Henderson had to play DC which is clearly not his position. Looks like Phillips and Kabak did a pretty good job having the minimum shots and goals conceded, though Kabak also suffered an injury at the end of the season. Fabinho had the most appearances despite not being DC which takes us to the next key point.\n\n## Lossing Fabinho in the midfield\n\nI think Fabinho is one of the keys to the success of the last season, and losing him in the midfield weakened the LFC game.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfabinho <- player_match %>% \n  filter(player_name == 'Fabinho')\n\n# Fabinho influence\nfab_perc_pts <- fabinho %>% \n  filter(year == 2020) %>% \n  mutate(\n    # Compute pts earned by liverpool\n    pts = case_when(\n      h_team == 'Liverpool' & h_goals > a_goals ~ 3, \n      a_team == 'Liverpool' & h_goals < a_goals ~ 3, \n                              h_goals == a_goals ~ 1,\n                                              T ~ 0\n    )\n  ) %>% \n  filter(position != 'Sub') %>% \n  group_by(position) %>% \n  summarise(\n    pts = sum(pts)/(n()*3),\n    games = n()\n  ) %>% \n  ggplot(aes(x = position, y = pts, fill = position, label = glue::glue('{games} games played'))) +\n  geom_col() +\n  geom_text(nudge_y = .05, size = 2.5) +\n  scale_y_continuous(labels = scales::percent) +\n  theme(legend.position = 'none') +\n  labs(x = '', y = '% of pts Earned', title = '% Points earned')\n\n# LFC Cumulative pts color by Fabinho position \nfab_cml_pts <- match_season %>% \n  filter(year == 2020) %>% \n  left_join(fabinho %>% filter(year == 2020), by = 'date') %>% \n  arrange(date) %>% \n  mutate(\n    cm_pts = cumsum(pts),\n    Matches = 1:n(),\n    position = replace_na(position, 'Injured')\n  ) %>% \n  ggplot(aes(x = Matches, y = cm_pts, color = position)) +\n  geom_point() +\n  theme(\n    legend.position = 'top',\n    legend.justification = 'left',\n    legend.title = element_blank()\n  ) +\n  labs(y = 'Points', title = 'LFC Cumulative Points', subtitle = 'Colored by Fabinho position')\n\n# Patchwork join\nfab_perc_pts + fab_cml_pts + \n  plot_layout(widths = c(1, 3)) +\n  plot_annotation(title = 'Fabinho Influence by Position')\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/fabinho-1.png){fig-align='center' width=576}\n:::\n:::\n\n\nWhen Fabinho plays DC LFC won only 49% of possible points, while as MC the number rises to 85%. You can see how the flattest runs happen at mid-season when he played as DC and even when he was injured (yes, he was injured too). And look at the comeback at the end of the season, he played as MC in all those victories... Yes, Klopp! show some love to that man!\n\n![](https://media.giphy.com/media/gIHPkMudZIZ4kqOjjV/giphy.gif)\n\n## Goals Shortfall\n\nInjuries weren't the only problem, goals shortfall also affected the performance\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Attackers\nmain_FW <- player_season %>% \n  filter(player_id %in% c(1250, 838, 482))\n\n# Attackers performances\nmain_FW %>% \n  transmute(\n    player_name, year,\n    Scored = ((npg+assists)/time)*90,\n    Expected = ((npxG+xA)/time)*90\n  ) %>%\n  pivot_longer(c(Scored, Expected)) %>% \n  ggplot(aes(x = year, y = value, color = name)) +\n  geom_line() +\n  geom_point() +\n  scale_x_continuous(breaks = c(2018, 2019, 2020)) +\n  facet_wrap(~player_name) +\n  theme(\n    legend.position = 'top',\n    legend.justification = 'left',\n    legend.title = element_blank()\n  ) +\n  labs(title = 'No penalty Goals + Assists per 90 minutes', y = 'G + A per 90m', x = '')\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/attackers-1.png){fig-align='center' width=768}\n:::\n:::\n\n\nAll three FW decrease their G+A per game in respect of their previous seasons, Especially Salah and Mane. Let's compare the top 5 contributors across seasons\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Main contributors by season\nplayer_season %>% \n  mutate(\n    GA_90m = ((npg+assists)/time)*90,\n    n = tidytext::reorder_within(player_name, GA_90m, year)\n  ) %>% \n  group_by(year) %>% \n  slice_max(order_by = GA_90m, n = 5) %>% \n  ggplot(aes(x = GA_90m, y = n)) +\n  geom_col() +\n  facet_wrap(~year, scales = 'free_y') +\n  tidytext::scale_y_reordered() +\n  labs(title = 'Top Contributors: G + A per 90 minutes', x = 'G + A per 90m', y = '')\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/attacks_contributors-1.png){fig-align='center' width=768}\n:::\n:::\n\n\nJota and Chamberlain played a big role in helping to fill the goal gap this season, though they both suffered major injuries that made them miss a lot of games\n\nLet's play around with the shots data to compare the top 5 shooters\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# All LFC shots\nlfc_shots <- match_shots %>% \n  filter((h_team == 'Liverpool' & h_a == 'h') | (a_team == 'Liverpool' & h_a == 'a'))\n\n# Top 5 shooters\n.shooters <- lfc_shots %>% \n  count(player_id) %>% \n  slice_max(order_by = n, n = 5) %>% \n  pull(player_id)\n\n# Build df for automagic_tabs2\nshooters_dataset <- lfc_shots %>% \n  filter(player_id %in% .shooters) %>% \n  group_by(player) %>% \n  nest() %>% \n  mutate(\n    shotplot = map(\n      data,\n      function(df){\n        shots <- df %>%\n          mutate(.x = X*100, .y = 100-Y*100)\n        \n        pitch_text <- shots %>%\n          summarise(\n            .x = 65,\n            `Shots per Goal` = n()/sum(result == 'Goal'),\n            `Average xG` = mean(xG)\n          ) %>% \n          pivot_longer(-.x) %>% \n          mutate(\n            .y = c(25, 75),\n            value = round(value, 2)\n          )\n        \n        shots %>% \n          filter(shotType != 'OtherBodyPart') %>% #To mantain consistency over color groups\n          ggplot(aes(x = .x, y = .y)) +\n          annotate_pitch() +\n          theme_pitch() +\n          geom_point(aes(size = xG, color = shotType, alpha = result == 'Goal')) +\n          geom_text(data = pitch_text, aes(label = glue::glue('{name}: {value}')), size = 3.5) +\n          scale_size_continuous(limits = c(0, 1), breaks = c(.3, .6, .9)) +\n          scale_alpha_manual(values = c(.3, 1), guide = FALSE) +\n          coord_flip(xlim = c(60, 100), ylim = c(0, 100))\n      }\n    ),\n    n_shots = map_dbl(data, ~nrow(.x))\n  ) %>% \n  arrange(desc(n_shots)) %>% \n  ungroup()\n```\n:::\n\n\nInspired by (@soccerPlots) For this, let's use [ggsoccer](https://github.com/Torvaney/ggsoccer) to set the soccer pitch as the background of the plot and `automagic_tabs2` function from [sknifedatar](https://rafzamb.github.io/sknifedatar/articles/automatic_tabs.html) (@automagic_tabs), that automates the process of building tabs.\n\nThis solution works for .rmd files. check [this so post](shttps://stackoverflow.com/questions/73585417/iterating-to-create-tabs-with-gt-in-quarto) for an alternative approach for .qmd files\n\n::: {.panel-tabset}\n\n#### Mohamed Salah\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-1-1.png){fig-align='center' width=576}\n:::\n:::\n\n\n#### Sadio Mané\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-1.png){fig-align='center' width=576}\n:::\n:::\n\n\n#### Roberto Firmino\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){fig-align='center' width=576}\n:::\n:::\n\n\n#### Trent Alexander-Arnold\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){fig-align='center' width=576}\n:::\n:::\n\n\n#### Diogo Jota\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){fig-align='center' width=576}\n:::\n:::\n\n\n:::\n\nSalah is the one that makes more shots and needed less to score, he also has better xG from shots coming from the right side and he barely tries his right foot. Firmino and Mane are more balanced, trying shots with their weak foot and head, but they need more shots to score. It seems like Jota is the one that better chooses his shots. Trent has it more difficult because he shots from away having lower xG.\n\n\n## Signning Performance\n\nLet's check the performance of summer signings Jota and Thiago\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nplayer_match %>%\n  filter(player_id %in% c(6854, 229), year %in% c(2020, 2019, 2018)) %>%\n  mutate(\n    GA = npg+assists,\n    xGA = npxG+xA\n  ) %>% \n  group_by(player_name, year) %>% \n  summarise(\n    `Possible Time Played (%)` = sum(time)/(n()*90),\n    `G+A per 90m` = (sum(GA)/sum(time))*90,\n    `Key Passes per 90m` = (sum(key_passes)/sum(time))*90\n  ) %>% \n  pivot_longer(-c(player_name, year)) %>% \n  ggplot(aes(x = year, y = value, color = player_name)) +\n  geom_line() +\n  geom_point() +\n  facet_grid(player_name~name, scales = 'free') +\n  theme(legend.position = 'none') +\n  scale_x_continuous(breaks = c(2018, 2019, 2020)) +\n  labs(x = '', y = '', title = 'Summer Signning Performance')\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/summer_players-1.png){fig-align='center' width=768}\n:::\n:::\n\n\nYou can see Diogo adapted very quickly, increasing G+A ratio of the last season, contrary to what happened with Thiago, that got better performance at the end of the season, being a key player in the midfield\n\n## Hoodability\n\nIn this [post](https://jogall.github.io/2017-08-04-robin-hood-teams/) (@Hoodability) were introduces the term of gaining points against the big six and loss against the bottom table. Let's check hoodability for this season\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Build Table\nposition_table <- epl %>% \n  filter(year == 2020) %>% \n  group_by(team_name) %>% \n  summarise(pts = sum(pts)) %>% \n  arrange(desc(pts)) %>% \n  transmute(team_name, position = 1:n())\n\n# pts earned by LFC\nmatch_shots %>% \n  distinct(h_team, a_team, h_goals, a_goals) %>% \n  transmute(\n    team_name = if_else(h_team == 'Liverpool', a_team, h_team),\n    pts =  case_when(\n      h_team == 'Liverpool' & h_goals > a_goals ~ 3, \n      a_team == 'Liverpool' & h_goals < a_goals ~ 3, \n      h_goals == a_goals ~ 1,\n      T ~ 0\n    )) %>% \n  left_join(position_table, by = 'team_name') %>% \n  mutate(\n    position_group = case_when(\n      position <= 6 ~ 'Top 6',\n      position >= 14 ~ 'Bottom 6',\n      T ~ 'Middle table'\n    )\n  ) %>% \n  group_by(position_group) %>% \n  summarise(\n    pts = sum(pts),\n    ppts = pts/(3*n())\n  ) %>% \n  ggplot(aes(x = position_group, y = ppts, label = glue::glue('Total pts earned: {pts}'))) +\n  geom_col() +\n  geom_text(nudge_y = .05) +\n  scale_y_continuous(labels = scales::percent) +\n  labs(y = 'Possible Points', x = 'Table Position', title = 'Possible Points Earned by Liverpool against')\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/hoodability-1.png){fig-align='center' width=576}\n:::\n:::\n\n\nPretty much the same possible points were earned at the bottom and top of the table, but you would expect to have a better performance against the bottom 6 teams\n\nSooooo, the 20-21 season was a tough one for LFC and we knew it the moment Virgil surgery was confirmed, but it got worse with Gomez and Matip injuries because basically, we run out of DC. Despite this, the team managed to qualify for Champions League with an amazing comeback and a memorable moment in Allison's 95' header against West Brom. Hopefully next season's analysis I will include more Klopp gifs running towards \"the Kop\"... In the meantime \n\n![](https://media.giphy.com/media/qmU61BkHHwSTRuiGZW/giphy.gif)\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}